<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
			The diffs are ordered by datamodel version number.
			The script can be run in a top down fashion and is
			expected to not failor overwrite old data

		EXPECT:
			- "use business-database-name;" was called prior to
			   calling this script
	</help>

	<diff>
		<version>1.0.0</version>                        
		<author>Robert O'Connor</author>
		<date>2 June 2009</date>
		<description>
		</description>
		<sql>
             create table if not exists `facilitydata_form_schema` (
                `schema_id` int(11) not null auto_increment,
                `uuid` char(36) not null,
                `name` varchar(255) not null,
                `description` varchar(255) default null,
                `frequency` varchar(255) not null,
                `valid_from` datetime default null,
                `valid_to` datetime default null,
                `creator` int(11) not null,
                `changed_by` int(11) default null,
                `date_created` datetime not null,
                `date_changed` datetime default null,
                `retired` tinyint(1) not null default '0',
                `retired_by` int(11) default null,
                `date_retired` datetime default null,
                `retired_reason` varchar(255) default null,
                 primary key (`schema_id`),
                 key `user who created this schema` (`creator`),
                 key `user who changed this schema` (`changed_by`),
                 key `user who retired this schama` (`retired_by`),
                 constraint `user who created this schema` foreign key (`creator`) references `users` (`user_id`) ,
                 constraint  `user who changed this schema` foreign key (`changed_by`) references `users` (`user_id`),
                 constraint  `user who retired this schema` foreign key (`retired_by`) references `users` (`user_id`)
            )ENGINE=InnoDB default CHARSET=utf8;
            
            create table if not exists `facilitydata_form_section` (
                `form_section_id` int(11)  not null auto_increment,
                `uuid` char(36) not null,
                `name` varchar(255) not null,
                `description` varchar(255) default null,
                `creator` int(11) not null,
                `changed_by` int(11) default null,
                `date_created` datetime not null,
                `date_changed` datetime default null,
                `retired` tinyint(1) not null default '0',
                `retired_by` int(11) default null,
                `date_retired` datetime default null,
                `retired_reason` varchar(255) default null,                                 
                 primary key (`form_section_id`),
                 key `user who created this section` (`creator`),
                 key `user who changed this section` (`changed_by`),
                 key `user who retired this section` (`retired_by`),
                 constraint `user who created this section` foreign key (`creator`) references `users` (`user_id`),
                 constraint  `user who changed this section` foreign key (`changed_by`) references `users` (`user_id`),
                 constraint  `user who retired this section` foreign key (`retired_by`) references `users` (`user_id`)
             )ENGINE=InnoDB default CHARSET=utf8;
             
             create table if not exists `facilitydata_question` (
                 `question_id` int(11) not null auto_increment,
                 `uuid` char(36) not null,
                 `name` varchar(255) not null,                
                 `description` varchar(1000) default null,
                 `creator` int(11) not null,
                 `changed_by` int(11) default null,
                 `date_changed` datetime default null,
                 `date_created` datetime not null,
                 `retired` tinyint(1) default '0',
                 `retired_by` int(11) default null,
                 `date_retired` datetime default null,
                 `retired_reason` varchar(255) default null,
                 `data_type` varchar(255) not null,
                 `aggregation_method` varchar(255) not null,
                 `min_value` double default null,
                 `max_value` double default null,
                 `allow_decimal` tinyint(1) default null,
                  primary key (`question_id`),
                  key `user who created this question` (`creator`),
                  key `user who changed this question` (`changed_by`),
                  key `user who retired this question` (`retired_by`),
                  constraint `user who created this question` foreign key (`creator`) references `users` (`user_id`),
                  constraint  `user who changed this question` foreign key (`changed_by`) references `users` (`user_id`),
                  constraint  `user who retired this question` foreign key (`retired_by`) references `users` (`user_id`)
             )ENGINE=InnoDB default CHARSET=utf8;
             
             create table if not exists `facilitydata_form_question` (
                  `form_question_id` int(11) not null auto_increment,
                  `name` varchar(255) not null,
                  `description` varchar(255) default null,
                  `uuid` char(36) not null,
                  `creator` int(11) not null,
                  `changed_by` int(11) default null,
                  `date_created` datetime not null,
                  `date_changed` datetime default null,
                  `retired` tinyint(1) default '0',
                  `retired_by` int(11) default null,
                  `date_retired` datetime default null,
                  `retired_reason` varchar(255) default null,
                  `question_number` varchar(255) not null,
                  `section` int(11) default null,
                  `question` int(11) default null,
                  primary key (`form_question_id`),
                  key `user who created this form question` (`creator`),
                  key `user who changed this form question` (`changed_by`),
                  key `user who retired this form question` (`retired_by`),
                  key `section this is associated with` (`section`),
                  key `question this is associated with` (`question`),
                  constraint `user who created this form question` foreign key (`creator`) references `users` (`user_id`),
                  constraint  `user who changed this form question` foreign key (`changed_by`) references `users` (`user_id`),
                  constraint  `user who retired this form question` foreign key (`retired_by`) references `users` (`user_id`),
                  constraint  `section this is associated with` foreign key (`section`) references `facilitydata_form_section` (`form_section_id`),
                  constraint  `question this is associated with` foreign key (`question`) references `facilitydata_question` (`question_id`)
             )ENGINE=InnoDB default CHARSET=utf8;
            
             create table if not exists `facilitydata_value` (
                  `id` int(11) not null auto_increment,
                  `uuid` char(36) not null,
                  `creator` int(11) not null,
                  `changed_by` int(11) default null,
                  `date_changed` datetime default null,
                  `date_created` datetime not null,
                  `voided` tinyint(1) default '0',
                  `voided_by` int(11) default null,
                  `date_voided` datetime default null,
                  `void_reason` varchar(255) default null,
                  `facility` int(11) not null,
                  `from_date` datetime not null,
                  `to_date` datetime not null,
                  `value_text` varchar(255) default null,
                  `value_numeric` double default null,
                  `question` int(11) not null,
                  `comments` varchar(255) default null,
                   primary key  (`id`),
                   key `user who created this record` (`creator`),
                   key `user who changed this record` (`changed_by`),
                   key `user who voided this record` (`voided_by`),
                   key `location of this clinic` (`facility`),
                   key `question which is associated` (`question`),
                   constraint  `user who created this record` foreign key (`creator`) references `users` (`user_id`),
                   constraint  `user who changed this record` foreign key (`changed_by`) references `users` (`user_id`),
                   constraint  `user who voided this record` foreign key (`voided_by`) references `users` (`user_id`),
                   constraint  `location of this clinic` foreign key (`facility`) references `location` (`location_id`),
                   constraint  `question which is associated` foreign key (`question`) references `facilitydata_question` (`question_id`)
             )ENGINE=InnoDB default CHARSET=utf8;
            create table if not exists `facilitydata_schemas` (
                  `schema_id` int(11) not null,
                  `section_id` int(11) not null,
                  `section_index` int(11), 
                   key `section` (`section_id`),
                   key `schema` (`schema_id`),
                   constraint `section` foreign key (`section_id`) references `facilitydata_form_section` (`form_section_id`),
                   constraint `schema` foreign key (`schema_id`) references `facilitydata_form_schema` (`schema_id`)
            )ENGINE=InnoDB default CHARSET=utf8;

		</sql>
	</diff>
</sqldiff>